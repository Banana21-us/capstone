<div class="container">
  <div class="table-container">
    <div class="row align-items-center">
      <div class="col d-flex align-items-center">
        <h2>Class List
          <button type="button" class="btn btn-success ms-2" routerLink="/main-page/classmanagement/addclass">+</button>
        </h2>
      </div>
      <div class="col d-flex justify-content-end">
        <mat-form-field>
          <mat-label>Filter by Class</mat-label>
          <input matInput [(ngModel)]="keyword" placeholder="Search any..." />
        </mat-form-field>
      </div>
    </div>

    <!-- Displaying submitted data -->
    <table id="classTable" class="table table-striped">
      <thead>
        <tr>
          <th>Level | Strand | Section</th>
          <th>Subject</th>
          <th>Teacher</th>
          <th>Time | Schedule</th>
          <th>Room</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let form of filteredClasses | searchFilter: keyword; let i = index">
          <!-- Determine if we need to show a header for Junior -->
          <tr *ngIf="i === 0 || (form.level >= 7 && form.level <= 10 && (filteredClasses[i - 1]?.level > 10 || filteredClasses[i - 1]?.level === undefined))">
            <td colspan="7" style="font-weight: bold; font-size: 1.2em;">
              Junior Classes
            </td>
          </tr>
      
          <!-- Class Row for Junior Classes -->
          <tr *ngIf="form.level >= 7 && form.level <= 10">
            <td>{{ form.level }} {{ form.strand.trim() === '-' ? ' ' : form.strand }} | {{ form.section_name }}</td>
            <td>{{ form.subject_name }}</td>
            <td>{{ form.fname }} {{ form.lname }}</td>
            <td>{{ form.time }} | {{ form.schedule }}</td>
            <td>{{ form.room }}</td>
            <td>
              <i class="bi bi-pencil-fill m-2 edit" type='button' (click)="openEditSubjectModal(form)"></i>
              <i class="bi bi-trash3-fill ms-3 delete" title="Delete" (click)="deleteClass(form.class_id)"></i>
            </td>
          </tr>
      
          <!-- Determine if we need to show a header for Senior -->
          <tr *ngIf="(form.level >= 11 && form.level <= 12 && (filteredClasses[i - 1]?.level <= 10 || filteredClasses[i - 1]?.level === undefined))">
            <td colspan="7" style="font-weight: bold; font-size: 1.2em;">
              Senior Classes {{ getOrdinal(form.semester) }} Semester
            </td>
          </tr>
      
          <!-- Class Row for Senior Classes -->
          <tr *ngIf="form.level >= 11 && form.level <= 12">
            <td>{{ form.level }} {{ form.strand.trim() === '-' ? ' ' : form.strand }} | {{ form.section_name }}</td>
            <td>{{ form.subject_name }}</td>
            <td>{{ form.fname }} {{ form.lname }}</td>
            <td>{{ form.time }} | {{ form.schedule }}</td>
            <td>{{ form.room }}</td>
            <td>
              <i class="bi bi-pencil-fill m-2 edit" type='button' (click)="openEditSubjectModal(form)"></i>
              <i class="bi bi-trash3-fill ms-3 delete" title="Delete" (click)="deleteClass(form.class_id)"></i>
            </td>
          </tr>
      
          <!-- Check if the next item is a different semester and valid -->
          <tr *ngIf="(form.level >= 11 && form.level <= 12 && filteredClasses[i + 1]?.semester !== undefined && filteredClasses[i + 1]?.semester !== null && filteredClasses[i + 1]?.semester !== form.semester)">
            <td colspan="7" style="font-weight: bold; font-size: 1.2em;">
              Senior Classes {{ getOrdinal(filteredClasses[i + 1].semester) }} Semester
            </td>
          </tr>
      
        </ng-container>
      
        <!-- If no classes available -->
        <tr *ngIf="(filteredClasses | searchFilter: keyword)?.length === 0">
          <td colspan="7"class="text-center">No classes available.</td>
        </tr>
      
      </tbody>
    </table>
  </div>
</div>